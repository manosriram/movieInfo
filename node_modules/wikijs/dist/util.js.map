{"version":3,"sources":["../src/util.js"],"names":["api","pagination","aggregatePagination","aggregate","fetchOptions","method","mode","credentials","Object","assign","format","action","redirects","params","keys","qs","forEach","key","apiOptions","origin","apiUrl","stringify","url","headers","then","res","json","error","Error","info","results","parseResults","query","srsearch","filter","continueType","continueKey","resolution","next","previousResults","pageLimit","list","prefix","map","e","continue","continueWith","nextFromKey","nextResults"],"mappings":"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","file":"util.js","sourcesContent":["import fetch from 'isomorphic-fetch';\nimport querystring from 'querystring';\n\nconst fetchOptions = {\n\tmethod: 'GET'\t,\n\tmode: 'cors',\n\tcredentials: 'omit'\n};\n\nexport function api(apiOptions, params = {}) {\n\tconst qs = Object.assign({\n\t\tformat: 'json',\n\t\taction: 'query',\n\t\tredirects: ''\n\t}, params);\n\t// Remove undefined properties\n\tObject.keys(qs).forEach(key => {\n\t\tif (qs[key] === undefined) {\n\t\t\tdelete qs[key];\n\t\t}\n\t});\n\tif (apiOptions.origin) {\n\t\tqs.origin = apiOptions.origin;\n\t}\n\tconst url = `${apiOptions.apiUrl}?${querystring.stringify(qs)}`;\n\treturn fetch(url, Object.assign({ headers: apiOptions.headers }, fetchOptions))\n\t\t.then(res => res.json())\n\t\t.then(res => {\n\t\t\tif (res.error) {\n\t\t\t\tthrow new Error(res.error.info);\n\t\t\t}\n\t\t\treturn res;\n\t\t});\n}\n\nexport function pagination(apiOptions, params, parseResults) {\n\treturn api(apiOptions, params)\n\t\t.then(res => {\n\t\t\tlet resolution = {};\n\t\t\tresolution.results = parseResults(res);\n\t\t\tresolution.query = params.srsearch;\n\t\t\tif (res['continue']) {\n\t\t\t\tconst continueType = Object\n\t\t\t\t\t.keys(res['continue'])\n\t\t\t\t\t.filter(key => key !== 'continue')[0];\n\t\t\t\tconst continueKey = res['continue'][continueType];\n\t\t\t\tparams[continueType] = continueKey;\n\t\t\t\tresolution.next = () => pagination(apiOptions, params, parseResults);\n\t\t\t}\n\t\t\treturn resolution;\n\t\t});\n}\n\nexport function aggregatePagination(pagination, previousResults = []) {\n\treturn pagination\n\t\t.then(res => {\n\t\t\tconst results = [...previousResults, ...res.results];\n\t\t\tif (res.next) {\n\t\t\t\treturn aggregatePagination(res.next(), results);\n\t\t\t} else {\n\t\t\t\treturn results;\n\t\t\t}\n\t\t});\n}\n\nconst pageLimit = 500;\n\nexport function aggregate(apiOptions, params, list, key, prefix, results = []) {\n\tparams.list = list;\n\tparams[prefix + 'limit'] = pageLimit;\n\treturn api(apiOptions, params)\n\t\t.then(res => {\n\t\t\tconst nextResults = [...results, ...res.query[list].map(e => e[key])];\n\t\t\tconst continueWith = res['query-continue'] || res.continue;\n\t\t\tif (continueWith) {\n\t\t\t\tconst nextFromKey = (continueWith[list] && continueWith[list][prefix + 'from']) || continueWith[prefix + 'continue'];\n\t\t\t\tparams[prefix + 'continue'] = nextFromKey;\n\t\t\t\tparams[prefix + 'from'] = nextFromKey;\n\t\t\t\treturn aggregate(apiOptions, params, list, key, prefix, nextResults);\n\t\t\t}\n\t\t\treturn nextResults;\n\t\t});\n}"]}